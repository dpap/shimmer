"use strict";angular.module("sandboxConsoleApp",["ngCookies","ngResource","ngSanitize","ngRoute","ui.date"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/authorizationComplete/:errorState",{templateUrl:"views/authorizationComplete.html",controller:"AuthorizationCompleteCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("sandboxConsoleApp").controller("AuthorizationCompleteCtrl",["$scope","$http","$window","$timeout","$routeParams",function(a,b,c,d,e){d(function(){c.location.href="http://localhost:18000/#/shimmercallback"},1e3)}]).controller("MainCtrl",["$scope","$http","$window",function(a,b,c){var d="";a.availables=[],a.shims=[],a.records=[],a.settingsOpen=!1,a.getHtmlId=function(a){return a.replace(/\W+/g,"_")},a.fromDate=moment().subtract(2,"days").format("MM/DD/YYYY"),a.toDate=moment().add(1,"days").format("MM/DD/YYYY"),a["goto"]=function(b,c){b.preventDefault(),b.stopPropagation(),$(".shim-nav li").removeClass("active");var d=$(b.currentTarget)[0];$(d).parent().addClass("active"),a.settingsOpen="settings"==c},a.saveSettings=function(c){var e=$($("#clientId-"+c)[0]).val(),f=$($("#clientSecret-"+c)[0]).val(),g=$("#settings-spinner-"+c);g.show();var h=d+"/shim/"+c+"/config";h+="?clientId="+e+"&clientSecret="+f,b({url:h,method:"PUT"}).success(function(){console.info("successfully updated settings."),g.hide(),a.loadShims()}).error(function(a,b){g.hide(),console.error("Could not update settings, error occurred.",a,b)})},a.loadShims=function(){var c=d+"/registry";b.get(c).success(function(b){a.shims=b}).error(function(a,b){console.error("Error querying the registry, try again.",b)}),b.get(c+"?available=true").success(function(b){a.availables=b}).error(function(a,b){console.error("Error querying the registry, could not retrieve available shims.",b)})},a.getShim=function(b){var c={};return a.shims&&0!=a.shims.length?(angular.forEach(a.shims,function(a,d){a.shimKey==b&&(c=a)}),c):c},a.doLookup=function(){var c=$($("#uid-term")[0]).val(),e=d+"/authorizations?username="+c.trim();b.get(e).success(function(b){console.info("The data is: ",b),a.records=b,0==b.length&&a.records.push({username:c,auths:[]})}).error(function(a,b){console.error("Error doing lookup, nothing found!",b)})},a.initOAuthFlow=function(e,f){var g=d+"/authorize/"+f+"?username="+e.username;b.get(g).success(function(b){console.info("Retrieved authorization URL: ",b.authorizationUrl);var d=screen.width/2-250,e=screen.height/2-250,f="resizable=0,scrollbars=1,width=500,height=500,left="+d+",top="+e,g=c.open(b.authorizationUrl,"_blank",f),h=window.setInterval(function(){try{(null==g||g.closed)&&(window.clearInterval(h),a.doLookup())}catch(b){}},1e3);g.focus()}).error(function(a,b){console.error("Error querying the registry, try again.",b)})},a.disconnect=function(e,f,g){if(c.confirm("Disconnect this shim, are you sure?")){e.preventDefault(),e.stopPropagation();var h=d+"/de-authorize/"+g+"?username="+f.username;b({url:h,method:"DELETE"}).success(function(){console.info("successfully disconnected."),a.doLookup()}).error(function(a,b){console.error("Could not disconnect, error occurred.",a,b)})}},a.getData=function(c,e,f,g){var h=a.getHtmlId(c.username)+"-"+e+"-"+f,i=$("#shim-error-"+h)[0],j=$("#shim-spinner-"+h)[0],k=$("#shim-results-"+h)[0],l=moment(new Date($($("#fromDate-"+h)[0]).val())).format("YYYY-MM-DD"),m=moment(new Date($($("#toDate-"+h)[0]).val())).format("YYYY-MM-DD");l&&""!=l||(l=moment().subtract(2,"days").format("YYYY-MM-DD")),m&&""!=m||(m=moment().add(1,"days").format("YYYY-MM-DD")),$(i).css("display","none"),$(k).css("display","none"),$(j).css("display","block");var n=d+"/data/"+e+"/"+f+"?username="+c.username+"&dateStart="+l+"&dateEnd="+m+(g?"&normalize=true":"&normalize=false");console.info("The URL to be used is: ",n),b.get(n).success(function(a){$(k).val(JSON.stringify(a,void 0,2)),$(j).css("display","none"),$(k).css("display","block")}).error(function(a,b){var c="Error, could not get data from server"+b;console.error(c),$(i).css("display","block"),$(i).html(c),$(j).css("display","none")})},a.openEndpoints=function(b,c,d){var e=$("#shim-panel-"+a.getHtmlId(c.username)+"-"+d)[0];console.info("Looking for element: ","#shim-panel-"+a.getHtmlId(c.username)+"-"+d),console.info("Element is: ",e.id),"none"==$(e).css("display")?$(e).slideDown(250):$(e).slideUp(250)},a.pickDate=function(b,c,d,e){var f=$("#"+b+"Date-"+a.getHtmlId(c.username)+"-"+d+"-"+e)[0];$(f).focus()},a.loadShims()}]);